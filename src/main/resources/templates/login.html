<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="include :: header">
    <script>if (window.top !== window.self) {
        window.top.location = window.location;
    }</script>
</head>

<body class="gray-bg">

<div class="middle-box text-center loginscreen  animated fadeInDown">
    <div>
        <div>
            <h1 class="logo-name">C-P</h1>
        </div>
        <h3>C-PLATFORM&nbsp;&nbsp;欢迎登录</h3>

        <form class="m-t text-left" role="form" id="loginForm">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="用户名" name="userName" required>
            </div>
            <div class="form-group">
                <input type="password" class="form-control" placeholder="密码" name="password" required>
            </div>
            <div class="form-group">
                <div class="row">
                    <div class="col-sm-6">
                        <input type="text" class="form-control" placeholder="验证码" name="validateCode" required>
                    </div>
                    <div class="col-sm-6">
                        <a href="javascript:void(0);" title="点击更换验证码">
                            <img src="/validateCode.jpg" onclick="refreshValidateCode(this)" style="width: 100%">
                        </a>
                    </div>
                </div>
            </div>
            <a class="btn btn-primary block full-width m-b" onclick="login()">登 录</a>

            <p class="text-muted text-center"><a href="login.html#"><small>忘记密码了？</small></a> | <a href="register">注册一个新账号</a>
            </p>

        </form>
    </div>
</div>
</body>

<div th:include="include :: footer"></div>
<script>
    $(function () {
        validateRule();
    })

    function login() {
        if($("#loginForm").valid()){
            var jsonForm = $("#loginForm").serializeJSON();
            var jsonStr = JSON.stringify(jsonForm)
            $.ajax({
                type : "POST",
                url : "/loginAction",
                data: jsonStr,
                contentType: 'application/json;charset=UTF-8',
                error : function(request) {
                    swal({title:'网络超时',type:'error'})
                },
                success : function(data) {
                    if (data.resultCode == 0) {
                        swal({title:'登录成功',type:'success'})
                    } else {
                        swal({title:data.resultMsg,type:'error'})
                    }
                }
            });
        }
    }

    function refreshValidateCode(that) {
        that.src = '/validateCode.jpg?'+Math.random()
    }

    function validateRule() {
        // $("#loginForm").validate({
        //     errorPlacement: function (e, r) {
        //         e.appendTo(r.is(':radio') || r.is(':checkbox') ? r.parent().parent().parent()  : r.parent())
        //     }
        // })
    }

</script>

</html>
